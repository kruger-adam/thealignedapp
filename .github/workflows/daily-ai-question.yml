name: Daily AI Question

on:
  schedule:
    # Runs every day at 12:00 PM UTC (adjust timezone as needed)
    # Format: minute hour day month day-of-week
    # This runs at exactly 12:00 PM UTC daily
    # To convert to your timezone: https://crontab.guru/#0_12_*_*_*
    - cron: '0 12 * * *'
  workflow_dispatch: # Allows manual triggering from GitHub UI

jobs:
  trigger-ai-question:
    runs-on: ubuntu-latest
    timeout-minutes: 5
    steps:
      - name: Trigger AI Question Endpoint
        env:
          APP_URL: ${{ secrets.APP_URL }}
          CRON_SECRET: ${{ secrets.CRON_SECRET }}
        run: |
          if [ -z "$APP_URL" ] || [ -z "$CRON_SECRET" ]; then
            echo "Error: APP_URL or CRON_SECRET secrets are not set"
            exit 1
          fi
          
          echo "Triggering AI question generation at $(date -u +"%Y-%m-%d %H:%M:%S UTC")"
          
          response=$(curl -X POST "$APP_URL/api/ai-question" \
            -H "Authorization: Bearer $CRON_SECRET" \
            -H "Content-Type: application/json" \
            -w "\nHTTP_STATUS:%{http_code}" \
            -s)
          
          http_status=$(echo "$response" | grep -o "HTTP_STATUS:[0-9]*" | cut -d: -f2)
          body=$(echo "$response" | sed '/HTTP_STATUS:/d')
          
          echo "Response status: $http_status"
          echo "Response body: $body"
          
          if [ "$http_status" -ge 200 ] && [ "$http_status" -lt 300 ]; then
            echo "✅ Success: AI question generated"
            exit 0
          else
            echo "❌ Error: Request failed with status $http_status"
            exit 1
          fi

